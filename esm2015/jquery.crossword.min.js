/**
 * @license jq-crossword v1.0.1
 * (c) 2018 Finsi, Inc.
 */

import{CrosswordDefinition}from"crossword-definition";var CrosswordFeedback;!function(s){s.clue="clue"}(CrosswordFeedback||(CrosswordFeedback={}));var CrosswordEvents;!function(s){s.onClueCompleted="crossword:clue",s.onSolved="crossword:solved"}(CrosswordEvents||(CrosswordEvents={}));class CrosswordCellRegistry{}class CrosswordClueRegistry{constructor(){this.cellsElements=[],this.fieldsElements=[],this.cellsRegistries=[],this.currentAnswer=[],this.isCompleted=!1}get cellsAsJquery(){return this._$cells||(this._$cells=$($.map(this.cellsElements,s=>s.get(0)))),this._$cells}get fieldsAsJquery(){return this._$fields||(this._$fields=$($.map(this.fieldsElements,s=>s.get(0)))),this._$fields}}class CrosswordRowRegistry{}class CrosswordGame{constructor(){this.cluesRegistry={}}destroy(){this.element.removeClass([this.options.classes.disabled,this.options.classes.root]),this.element.off("."+this.options.namespace),this.board.remove(),this.acrossCluesContainer.remove(),this.acrossCluesList.remove(),this.downCluesContainer.remove(),this.downCluesList.remove(),this._super()}disable(){this._super(),this.element.addClass(this.options.classes.disabled);const s=this.cluesRegistry;for(let e in s){const t=s[e];t.fieldsAsJquery.prop("disabled",!0)}}enable(){this._super(),this.element.removeClass(this.options.classes.disabled);const s=this.cluesRegistry;for(let e in s){const t=s[e];t.fieldsAsJquery.prop("disabled",!1)}}goToCell(s,e){let t,i,o;if("number"==(typeof s).toLowerCase()){let o=this.rowsRegistry[s];o&&(i=(t=o.cellsRegistry[e]).definition)}else i=(t=s).definition;return t&&i.light&&t!=this.registryCellActive&&(i.acrossClue&&i.downClue&&(0==i.acrossClueLetterIndex?o=i.acrossClue:0==i.downClueLetterIndex&&(o=i.downClue)),this.registryActive?(this.registryCellActive.element.removeClass(this.options.classes.cellActive),o=this.registryActive.definition==i.acrossClue?i.acrossClue:this.registryActive.definition==i.downClue?i.downClue:this._getDefinitionForClosestToFirstLetter(t.definition)):o=this._getDefinitionForClosestToFirstLetter(t.definition),this.registryCellActive=t,t.element.addClass(this.options.classes.cellActive),this._activateClue(o),t.field.is(":focus")||t.field.trigger("focus")),t}clearActive(){this.registryActive&&(this.registryActive=null,this.element.find("."+this.options.classes.clueActive).removeClass(this.options.classes.clueActive),this.registryCellActive.element.removeClass(this.options.classes.cellActive),this.registryCellActive=null)}goToCellAbove(){if(this.registryCellActive){let s=this._getCellFor(this.registryCellActive,!0,!1);s&&this.goToCell(s)}}goToCellBelow(){if(this.registryCellActive){let s=this._getCellFor(this.registryCellActive,!0,!0);s&&this.goToCell(s)}}goToCellRight(){if(this.registryCellActive){let s=this._getCellFor(this.registryCellActive,!1,!0);s&&this.goToCell(s)}}goToCellLeft(){if(this.registryCellActive){let s=this._getCellFor(this.registryCellActive,!1,!1);s&&this.goToCell(s)}}goToNextWord(){if(this.registryCellActive){let s=this._getNextOrPrevClueFrom(this.registryCellActive,!0);this.cluesRegistry[s.code].fieldsElements[0].trigger("focus")}}goToPrevWord(){if(this.registryCellActive){let s=this._getNextOrPrevClueFrom(this.registryCellActive,!1);this.cluesRegistry[s.code].fieldsElements[0].trigger("focus")}}checkClue(s){let e;if(s=s||this.registryActive){const t=s.isCompleted;if(s.isCompleted=s.currentAnswer.join("").length===s.definition.answer.length,s.isCompleted){let t=0;const i=s.cellsRegistries;for(let s of i)this._checkCellAnswer(s)&&t++;s.isCorrect=t==i.length,this._updateClueStateClass(s),e=s.isCorrect}else s.isCorrect=!1,this._updateClueStateClass(s);t!=s.isCompleted&&this.element.trigger(CrosswordEvents.onClueCompleted,[{instance:this,isCorrect:s.isCorrect,isCompleted:!1,definition:s.definition}])}return e}check(){const s=this.cluesRegistry;let e=0;for(let t in s){const i=s[t];if(!i.isCorrect)break;e++}e==Object.keys(s).length&&this.element.trigger(CrosswordEvents.onSolved,[this])}solve(){const s=this.cluesRegistry;for(let e in s){const t=s[e],i=t.cellsRegistries;for(let s of i)s.field.val(s.definition.answer)}this.element.trigger(CrosswordEvents.onSolved,[this])}_getCreateOptions(){return{namespace:"jq-crossword",classes:{root:"c-crossword",board:"c-crossword__board",row:"c-crossword__row",cell:"c-crossword__cell",cellActive:"c-crossword__cell--active",cellCorrect:"c-crossword__cell--correct",cellIncorrect:"c-crossword__cell--incorrect",clue:"c-crossword__clue",clueActive:"c-crossword__clue--active",clueCorrect:"c-crossword__clue--correct",clueIncorrect:"c-crossword__clue--incorrect",light:"c-crossword__clue--light",hint:"c-crossword__clue--hint",field:"c-crossword__clue__field",firstLetter:"c-crossword__cell--first-letter",firstLetterAcross:"c-crossword__cell--first-letter-across",firstLetterDown:"c-crossword__cell--first-letter-down",listItem:"c-crossword__list-item",cluesListContainer:"c-crossword__clues",cluesListTitle:"c-crossword__clues__title",clueList:"c-crossword__clues__list",disabled:"c-crossword--disabled"},downListTitle:"Down clues",acrossListTitle:"Across clues",ignoreCase:!0,feedback:CrosswordFeedback.clue}}_checkCellAnswer(s){return s.field.val()&&(this.options.ignoreCase?s.isCorrect=new RegExp(s.definition.answer,"i").test(s.currentAnswer):s.isCorrect=s.currentAnswer==s.definition.answer),s.isCorrect}_create(){this.element.addClass(this.options.classes.root),this._createDefinition(),this.cluesRegistry=this._createClueRegistry(),this._construct(),this._createCluesLists(),this._addEvents()}_addEvents(){this.element.on(`focus.${this.options.namespace}`,"."+this.options.classes.field,this._onFieldFocus.bind(this)),this.element.on(`blur.${this.options.namespace}`,"."+this.options.classes.field,this._onFieldBlur.bind(this)),this.element.on(`input.${this.options.namespace}`,"."+this.options.classes.field,this._onFieldChange.bind(this)),this.element.on(`keydown.${this.options.namespace}`,"."+this.options.classes.field,this._onFieldKey.bind(this)),this.element.on(`click.${this.options.namespace}`,"."+this.options.classes.listItem,this._onListItemClick.bind(this))}_updateClueStateClass(s){if(s.isCompleted){let e=s.isCorrect?this.options.classes.clueCorrect:this.options.classes.clueIncorrect,t=s.isCorrect?this.options.classes.clueIncorrect:this.options.classes.clueCorrect;s.listItem.removeClass(t).addClass(e),s.cellsAsJquery.removeClass(t).addClass(e)}else{const e=s.cellsRegistries;for(let s of e)s.acrossClueRegistry&&s.downClueRegistry&&(s.acrossClueRegistry.isCompleted||s.downClueRegistry.isCompleted)||s.element.removeClass([this.options.classes.clueCorrect,this.options.classes.clueIncorrect]);s.listItem.removeClass([this.options.classes.clueCorrect,this.options.classes.clueIncorrect])}}_onListItemClick(s){if(this.options.disabled)s.preventDefault();else{this.interaction=!0;let e,t=$(s.target),i=t.data("down"),o=t.data("across");e=i?this.cluesRegistry[i].cellsRegistries[0]:this.cluesRegistry[o].cellsRegistries[0],this.goToCell(e),this.interaction=!1}}_getDefinitionForClosestToFirstLetter(s){return s.acrossClue&&s.downClue?s.acrossClueLetterIndex<=s.downClueLetterIndex?s.acrossClue:s.downClue:s.acrossClue||s.downClue}_onFieldFocus(s){if(this.options.disabled)s.preventDefault();else{this.interaction=!0;let e=$(s.target),t=e.parents("."+this.options.classes.cell).first(),i=t.data("x"),o=t.data("y");this.goToCell(o,i),this.interaction=!1}}_onFieldBlur(s){this.interaction||this.clearActive()}_storeAndCheckAnswer(s,e){if(e.currentAnswer=s,e.definition.acrossClue){let t=this.cluesRegistry[e.definition.acrossClue.code],i=e.definition.acrossClueLetterIndex;t.currentAnswer[i]=s,this.options.feedback===CrosswordFeedback.clue&&this.checkClue(t)}if(e.definition.downClue){let t=this.cluesRegistry[e.definition.downClue.code],i=e.definition.downClueLetterIndex;t.currentAnswer[i]=s,this.options.feedback===CrosswordFeedback.clue&&this.checkClue(t)}this.check()}_onFieldChange(s){if(this.options.disabled)s.preventDefault();else{this.interaction=!0;let e=this.registryCellActive.field.val();if(!this.registryActive){let e=$(s.target),t=e.parents("."+this.options.classes.cell).first(),i=t.data("x"),o=t.data("y");this.goToCell(o,i)}this._storeAndCheckAnswer(e,this.registryCellActive),e?this.registryActive.definition.across?this.goToCellRight():this.goToCellBelow():this.registryActive.definition.across?this.goToCellLeft():this.goToCellAbove(),this.interaction=!1}}_activateClue(s){let e=this.cluesRegistry[s.code];e&&e!=this.registryActive&&(this.registryActive=e,this.element.find("."+this.options.classes.clueActive).removeClass(this.options.classes.clueActive),e.cellsAsJquery.addClass(this.options.classes.clueActive),e.listItem.addClass(this.options.classes.clueActive))}_getNextOrPrevClueFrom(s,e){let t,i,o,r,n,l,c=s.definition;if(c.acrossClue&&c.downClue){let e=this._getDefinitionForClosestToFirstLetter(s.definition);i=e.across,o=e}else i=void 0!=c.acrossClue,o=i?c.acrossClue:c.downClue;if(r=i?c.crossword.acrossClues:c.crossword.downClues,n=i?c.crossword.downClues:c.crossword.acrossClues,-1!=(l=r.findIndex(s=>s.number===o.number))){l+=e?1:-1;t=targetClue=e&&l<r.length||!e&&l>=0?r[l]:e?n[0]:n.slice(-1)[0]}return t}_getCellFor(s,e,t){let i,o=s.definition,r=o.x,n=o.y,l=e?t?n+1:n-1:n,c=e?r:t?r+1:r-1,a=this.rowsRegistry[l];if(a){let s=a.cellsRegistry[c];s&&s.definition.light&&(i=s.definition.hint?this._getCellFor(s,e,t):s)}return i}_onFieldKey(s){if(this.options.disabled)s.preventDefault();else{this.interaction=!0;let e=$(s.target),t=e.parents("."+this.options.classes.cell).first(),i=t.data("x"),o=t.data("y"),r=this.rowsRegistry[o].cellsRegistry[i];switch(s.which){case $.ui.keyCode.SPACE:s.preventDefault();break;case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:s.preventDefault(),s.shiftKey?this.goToPrevWord():this.goToNextWord();break;case $.ui.keyCode.UP:this.goToCellAbove();break;case $.ui.keyCode.RIGHT:this.goToCellRight();break;case $.ui.keyCode.DOWN:this.goToCellBelow();break;case $.ui.keyCode.LEFT:this.goToCellLeft();break;case $.ui.keyCode.BACKSPACE:s.preventDefault(),r.field.val("").trigger("input");break;default:1==s.key.length&&(s.preventDefault(),r.field.val(s.key).trigger("input"))}this.interaction=!1}}_createBoard(){return"function"==(typeof this.options.createBoard).toLowerCase()?this.options.createBoard.apply(this,arguments):$(`<table class="${this.options.classes.board}"></table>`)}_createRow(s){return"function"==(typeof this.options.createRow).toLowerCase()?this.options.createRow.apply(this,arguments):$(`<tr class="${this.options.classes.row}" data-row="${s}"></tr>`)}_createCell(s){return"function"==(typeof this.options.createCell).toLowerCase()?this.options.createCell.apply(this,arguments):$(`<td></td>`)}_createCellField(s){return"function"==(typeof this.options.createCellField).toLowerCase()?this.options.createCellField.apply(this,arguments):$(`<input maxlength="1" tabindex="-1">`)}_createCluesListContainer(s){return"function"==(typeof this.options.createCluesListContainer).toLowerCase()?this.options.createCluesListContainer.apply(this,arguments):$(`\n                <div class="${this.options.classes.cluesListContainer}">\n                    <p class="${this.options.classes.cluesListTitle}">${s?this.options.acrossListTitle:this.options.downListTitle}</p>\n                </div>\n            `)}_createCluesList(s){return"function"==(typeof this.options.createCluesList).toLowerCase()?this.options.createCluesList.apply(this,arguments):$(`<ul class="${this.options.classes.clueList}"></ul>`)}_createCluesListItem(s){return"function"==(typeof this.options.createCluesListItem).toLowerCase()?this.options.createCluesListItem.apply(this,arguments):$(`<li></li>`)}_createDownCluesList(){let s=this.definition.downClues;this.downCluesContainer=this._createCluesListContainer(!1),this.downCluesList=this._createCluesList(!1);for(let e of s){const s=this._createCluesListItem(e);this._addInfoToListElement(s,e),this.downCluesList.append(s),this.cluesRegistry[e.code].listItem=s}this.downCluesContainer&&this.downCluesContainer.append(this.downCluesList)}_createAcrossCluesList(){let s=this.definition.acrossClues;this.acrossCluesContainer=this._createCluesListContainer(!0),this.acrossCluesList=this._createCluesList(!0);for(let e of s){const s=this._createCluesListItem(e);this._addInfoToListElement(s,e),this.acrossCluesList.append(s),this.cluesRegistry[e.code].listItem=s}this.acrossCluesContainer&&this.acrossCluesContainer.append(this.acrossCluesList)}_createCluesLists(){this._createAcrossCluesList(),this._createDownCluesList(),this.options.acrossListAppendTo?this.acrossCluesContainer?$(this.options.acrossListAppendTo).append(this.acrossCluesContainer):$(this.options.acrossListAppendTo).append(this.acrossCluesList):this.element.append(this.acrossCluesContainer),this.options.downListAppendTo?this.downCluesContainer?$(this.options.downListAppendTo).append(this.downCluesContainer):$(this.options.downListAppendTo).append(this.downCluesList):this.element.append(this.downCluesContainer)}_addInfoToListElement(s,e){s.addClass(this.options.classes.listItem),e.across?(s.addClass(this.options.classes.clue+"--"+e.code),s.attr("data-across",e.code)):(s.addClass(this.options.classes.clue+"--"+e.code),s.attr("data-down",e.code)),s.text(e.clue)}_addInfoToCellElement(s,e){s.attr({"data-x":e.x,"data-y":e.y}),(e.acrossClue||e.downClue)&&s.addClass(this.options.classes.clue),e.clueLabel&&(s.addClass(this.options.classes.firstLetter),0==e.acrossClueLetterIndex&&s.addClass(this.options.classes.firstLetterAcross),0==e.downClueLetterIndex&&s.addClass(this.options.classes.firstLetterDown)),e.acrossClue&&(s.addClass(this.options.classes.clue+"--"+e.acrossClue.code),s.attr("data-across",e.acrossClue.number)),e.downClue&&(s.addClass(this.options.classes.clue+"--"+e.downClue.code),s.attr("data-down",e.downClue.number)),e.light&&(s.addClass(this.options.classes.light),e.hint&&s.addClass(this.options.classes.hint))}_createClueRegistry(){let s={},e=this.definition,t=e.acrossClues.concat(e.downClues);for(let e=0,i=t.length;e<i;e++){let i=t[e],o=new CrosswordClueRegistry;o.definition=i,o.currentAnswer=new Array(i.answer.length),s[i.code]=o}return s}_construct(){if(this.definition){let s=this.definition,e=s.matrix,t=this._createBoard(),i=[],o=this.cluesRegistry;this.board=t;for(let s=0,r=e.length;s<r;s++){let r,n=e[s],l=[],c=[],a=new CrosswordRowRegistry;a.cellsRegistry=c;for(let s=0,e=n.length;s<e;s++){let e,t=n[s],i=this._createCell(t).addClass(this.options.classes.cell),r=new CrosswordCellRegistry;if(r.rowRegistry=a,this._addInfoToCellElement(i,t),r.definition=t,r.element=i,t.light)if(t.hint){if(i.text(t.answer),t.acrossClue){let s=o[t.acrossClue.code];s.currentAnswer[t.acrossClueLetterIndex]=t.answer}if(t.downClue){let s=o[t.downClue.code];s.currentAnswer[t.downClueLetterIndex]=t.answer}}else{if((e=this._createCellField(t)).addClass(this.options.classes.field),r.field=e,i.append(e),t.acrossClue){let s=o[t.acrossClue.code];s.cellsElements.push(i),s.fieldsElements.push(e),s.cellsRegistries.push(r),r.acrossClueRegistry=s}if(t.downClue){let s=o[t.downClue.code];s.cellsElements.push(i),s.fieldsElements.push(e),s.cellsRegistries.push(r),r.downClueRegistry=s}}l.push(i),c[s]=r}(r=this._createRow(s))?(a.element=r,r.append(l),t.append(r)):t.append(l),i.push(a)}this.rowsRegistry=i,this.element.append(t)}}_createDefinition(){let s=this.options.definition;s&&(s instanceof CrosswordDefinition!=!0&&(s=new CrosswordDefinition(s)),this.definition=s)}}if(Object.hasOwnProperty("getOwnPropertyDescriptors")){let s={},e=Object.getOwnPropertyNames(CrosswordGame.prototype);for(let t=0,i=e.length;t<i;t++){let i=e[t];s[i]=Object.getOwnPropertyDescriptor(CrosswordGame.prototype,i).value}$.widget("ui.snapPuzzle",s)}else $.widget("ui.snapPuzzle",CrosswordGame);export{CrosswordFeedback,CrosswordEvents,CrosswordCellRegistry,CrosswordClueRegistry,CrosswordRowRegistry,CrosswordGame};
