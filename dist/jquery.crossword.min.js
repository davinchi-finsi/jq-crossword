/**
 * @license jq-crossword v0.0.1
 * (c) 2018 Finsi, Inc.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("crossword-definition")):"function"==typeof define&&define.amd?define(["exports","crossword-definition"],t):t((e.$=e.$||{},e.$.crossword={}),e.crosswordDefinition)}(this,function(e,t){"use strict";var s,i;(s=e.CrosswordFeedback||(e.CrosswordFeedback={}))[s.clue="clue"]="clue",(i=e.CrosswordEvents||(e.CrosswordEvents={}))[i.onClueCompleted="crossword:clue"]="onClueCompleted",i[i.onSolved="crossword:solved"]="onSolved";var o=function(){return function(){}}(),r=function(){function e(){this.cellsElements=[],this.fieldsElements=[],this.cellsRegistries=[],this.currentAnswer=[],this.isCompleted=!1}return Object.defineProperty(e.prototype,"cellsAsJquery",{get:function(){return this._$cells||(this._$cells=$($.map(this.cellsElements,function(e){return e.get(0)}))),this._$cells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fieldsAsJquery",{get:function(){return this._$fields||(this._$fields=$($.map(this.fieldsElements,function(e){return e.get(0)}))),this._$fields},enumerable:!0,configurable:!0}),e}(),n=function(){return function(){}}(),l=function(){function s(){this.cluesRegistry={}}return s.prototype.disable=function(){this._super(),this.element.addClass(this.options.classes.disabled);var e=this.cluesRegistry;for(var t in e){e[t].fieldsAsJquery.prop("disabled",!0)}},s.prototype.enable=function(){this._super(),this.element.removeClass(this.options.classes.disabled);var e=this.cluesRegistry;for(var t in e){e[t].fieldsAsJquery.prop("disabled",!1)}},s.prototype.goToCell=function(e,t){var s,i,o;if("number"==(typeof e).toLowerCase()){var r=this.rowsRegistry[e];r&&(i=(s=r.cellsRegistry[t]).definition)}else i=(s=e).definition;return s&&i.light&&s!=this.registryCellActive&&(i.acrossClue&&i.downClue&&(0==i.acrossClueLetterIndex?o=i.acrossClue:0==i.downClueLetterIndex&&(o=i.downClue)),this.registryActive?(this.registryCellActive.element.removeClass(this.options.classes.cellActive),o=this.registryActive.definition==i.acrossClue?i.acrossClue:this.registryActive.definition==i.downClue?i.downClue:this._getDefinitionForClosestToFirstLetter(s.definition)):o=this._getDefinitionForClosestToFirstLetter(s.definition),this.registryCellActive=s,s.element.addClass(this.options.classes.cellActive),this._activateClue(o),s.field.is(":focus")||s.field.trigger("focus")),s},s.prototype.clearActive=function(){this.registryActive&&(this.registryActive=null,this.element.find("."+this.options.classes.clueActive).removeClass(this.options.classes.clueActive),this.registryCellActive.element.removeClass(this.options.classes.cellActive),this.registryCellActive=null)},s.prototype.goToCellAbove=function(){if(this.registryCellActive){var e=this._getCellFor(this.registryCellActive,!0,!1);e&&this.goToCell(e)}},s.prototype.goToCellBelow=function(){if(this.registryCellActive){var e=this._getCellFor(this.registryCellActive,!0,!0);e&&this.goToCell(e)}},s.prototype.goToCellRight=function(){if(this.registryCellActive){var e=this._getCellFor(this.registryCellActive,!1,!0);e&&this.goToCell(e)}},s.prototype.goToCellLeft=function(){if(this.registryCellActive){var e=this._getCellFor(this.registryCellActive,!1,!1);e&&this.goToCell(e)}},s.prototype.goToNextWord=function(){if(this.registryCellActive){var e=this._getNextOrPrevClueFrom(this.registryCellActive,!0);this.cluesRegistry[e.code].fieldsElements[0].trigger("focus")}},s.prototype.goToPrevWord=function(){if(this.registryCellActive){var e=this._getNextOrPrevClueFrom(this.registryCellActive,!1);this.cluesRegistry[e.code].fieldsElements[0].trigger("focus")}},s.prototype.checkClue=function(t){var s;if(t=t||this.registryActive){var i=t.isCompleted;if(t.isCompleted=t.currentAnswer.join("").length===t.definition.answer.length,t.isCompleted){for(var o=0,r=t.cellsRegistries,n=0,l=r;n<l.length;n++){var c=l[n];this._checkCellAnswer(c)&&o++}t.isCorrect=o==r.length,this.updateClueStateClass(t),s=t.isCorrect}else t.isCorrect=!1,this.updateClueStateClass(t);i!=t.isCompleted&&this.element.trigger(e.CrosswordEvents.onClueCompleted,[{instance:this,isCorrect:t.isCorrect,isCompleted:!1,definition:t.definition}])}return s},s.prototype.check=function(){var t=this.cluesRegistry,s=0;for(var i in t){if(!t[i].isCorrect)break;s++}s==Object.keys(t).length&&this.element.trigger(e.CrosswordEvents.onSolved,[this])},s.prototype.solve=function(){var t=this.cluesRegistry;for(var s in t)for(var i=0,o=t[s].cellsRegistries;i<o.length;i++){var r=o[i];r.field.val(r.definition.answer)}this.element.trigger(e.CrosswordEvents.onSolved,[this])},s.prototype._getCreateOptions=function(){return{namespace:"jq-crossword",classes:{root:"c-crossword",board:"c-crossword__board",row:"c-crossword__row",cell:"c-crossword__cell",cellActive:"c-crossword__cell--active",cellCorrect:"c-crossword__cell--correct",cellIncorrect:"c-crossword__cell--incorrect",clue:"c-crossword__clue",clueActive:"c-crossword__clue--active",clueCorrect:"c-crossword__clue--correct",clueIncorrect:"c-crossword__clue--incorrect",light:"c-crossword__clue--light",hint:"c-crossword__clue--hint",field:"c-crossword__clue__field",firstLetter:"c-crossword__cell--first-letter",firstLetterAcross:"c-crossword__cell--first-letter-across",firstLetterDown:"c-crossword__cell--first-letter-down",listItem:"c-crossword__list-item",cluesListContainer:"c-crossword__clues",cluesListTitle:"c-crossword__clues__title",clueList:"c-crossword__clues__list",disabled:"c-crossword--disabled"},downListTitle:"Down clues",acrossListTitle:"Across clues",ignoreCase:!0,feedback:e.CrosswordFeedback.clue}},s.prototype._checkCellAnswer=function(e){return e.field.val()&&(this.options.ignoreCase?e.isCorrect=new RegExp(e.definition.answer,"i").test(e.currentAnswer):e.isCorrect=e.currentAnswer==e.definition.answer),e.isCorrect},s.prototype._create=function(){this.element.addClass(this.options.classes.root),this._createDefinition(),this.cluesRegistry=this._createClueRegistry(),this._construct(),this._createCluesLists(),this._addEvents()},s.prototype._addEvents=function(){this.element.on("focus."+this.options.namespace,"."+this.options.classes.field,this._onFieldFocus.bind(this)),this.element.on("blur."+this.options.namespace,"."+this.options.classes.field,this._onFieldBlur.bind(this)),this.element.on("input."+this.options.namespace,"."+this.options.classes.field,this._onFieldChange.bind(this)),this.element.on("keydown."+this.options.namespace,"."+this.options.classes.field,this._onFieldKey.bind(this)),this.element.on("click."+this.options.namespace,"."+this.options.classes.listItem,this._onListItemClick.bind(this))},s.prototype.updateClueStateClass=function(e){if(e.isCompleted){var t=e.isCorrect?this.options.classes.clueCorrect:this.options.classes.clueIncorrect,s=e.isCorrect?this.options.classes.clueIncorrect:this.options.classes.clueCorrect;e.listItem.removeClass(s).addClass(t),e.cellsAsJquery.removeClass(s).addClass(t)}else{for(var i=0,o=e.cellsRegistries;i<o.length;i++){var r=o[i];r.acrossClueRegistry&&r.downClueRegistry&&(r.acrossClueRegistry.isCompleted||r.downClueRegistry.isCompleted)||r.element.removeClass([this.options.classes.clueCorrect,this.options.classes.clueIncorrect])}e.listItem.removeClass([this.options.classes.clueCorrect,this.options.classes.clueIncorrect])}},s.prototype._onListItemClick=function(e){if(this.options.disabled)e.preventDefault();else{this.interaction=!0;var t=$(e.target),s=t.data("down"),i=t.data("across"),o=void 0;o=s?this.cluesRegistry[s].cellsRegistries[0]:this.cluesRegistry[i].cellsRegistries[0],this.goToCell(o),this.interaction=!1}},s.prototype._getDefinitionForClosestToFirstLetter=function(e){return e.acrossClue&&e.downClue?e.acrossClueLetterIndex<=e.downClueLetterIndex?e.acrossClue:e.downClue:e.acrossClue||e.downClue},s.prototype._onFieldFocus=function(e){if(this.options.disabled)e.preventDefault();else{this.interaction=!0;var t=$(e.target).parents("."+this.options.classes.cell).first(),s=t.data("x"),i=t.data("y");this.goToCell(i,s),this.interaction=!1}},s.prototype._onFieldBlur=function(e){this.interaction||this.clearActive()},s.prototype._storeAndCheckAnswer=function(t,s){if(s.currentAnswer=t,s.definition.acrossClue){var i=this.cluesRegistry[s.definition.acrossClue.code],o=s.definition.acrossClueLetterIndex;i.currentAnswer[o]=t,this.options.feedback===e.CrosswordFeedback.clue&&this.checkClue(i)}if(s.definition.downClue){i=this.cluesRegistry[s.definition.downClue.code],o=s.definition.downClueLetterIndex;i.currentAnswer[o]=t,this.options.feedback===e.CrosswordFeedback.clue&&this.checkClue(i)}this.check()},s.prototype._onFieldChange=function(e){if(this.options.disabled)e.preventDefault();else{this.interaction=!0;var t=this.registryCellActive.field.val();if(!this.registryActive){var s=$(e.target).parents("."+this.options.classes.cell).first(),i=s.data("x"),o=s.data("y");this.goToCell(o,i)}this._storeAndCheckAnswer(t,this.registryCellActive),t?this.registryActive.definition.across?this.goToCellRight():this.goToCellBelow():this.registryActive.definition.across?this.goToCellLeft():this.goToCellAbove(),this.interaction=!1}},s.prototype._activateClue=function(e){var t=this.cluesRegistry[e.code];t&&t!=this.registryActive&&(this.registryActive=t,this.element.find("."+this.options.classes.clueActive).removeClass(this.options.classes.clueActive),t.cellsAsJquery.addClass(this.options.classes.clueActive),t.listItem.addClass(this.options.classes.clueActive))},s.prototype._getNextOrPrevClueFrom=function(e,t){var s,i,o,r,n,l,c=e.definition;if(c.acrossClue&&c.downClue){var a=this._getDefinitionForClosestToFirstLetter(e.definition);i=a.across,o=a}else i=void 0!=c.acrossClue,o=i?c.acrossClue:c.downClue;if(r=i?c.crossword.acrossClues:c.crossword.downClues,n=i?c.crossword.downClues:c.crossword.acrossClues,-1!=(l=r.findIndex(function(e){return e.number===o.number}))){l+=t?1:-1;s=t&&l<r.length||!t&&l>=0?r[l]:t?n[0]:n.slice(-1)[0]}return s},s.prototype._getCellFor=function(e,t,s){var i,o=e.definition,r=o.x,n=o.y,l=t?s?n+1:n-1:n,c=t?r:s?r+1:r-1,a=this.rowsRegistry[l];if(a){var d=a.cellsRegistry[c];d&&d.definition.light&&(i=d.definition.hint?this._getCellFor(d,t,s):d)}return i},s.prototype._onFieldKey=function(e){if(this.options.disabled)e.preventDefault();else{this.interaction=!0;var t=$(e.target).parents("."+this.options.classes.cell).first(),s=t.data("x"),i=t.data("y"),o=this.rowsRegistry[i].cellsRegistry[s];switch(e.which){case $.ui.keyCode.SPACE:e.preventDefault();break;case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:e.preventDefault(),e.shiftKey?this.goToPrevWord():this.goToNextWord();break;case $.ui.keyCode.UP:this.goToCellAbove();break;case $.ui.keyCode.RIGHT:this.goToCellRight();break;case $.ui.keyCode.DOWN:this.goToCellBelow();break;case $.ui.keyCode.LEFT:this.goToCellLeft();break;case $.ui.keyCode.BACKSPACE:e.preventDefault(),o.field.val("").trigger("input");break;default:1==e.key.length&&(e.preventDefault(),o.field.val(e.key).trigger("input"))}this.interaction=!1}},s.prototype._createBoard=function(){return"function"==(typeof this.options.createBoard).toLowerCase()?this.options.createBoard.apply(this,arguments):$('<table class="'+this.options.classes.board+'"></table>')},s.prototype._createRow=function(e){return"function"==(typeof this.options.createRow).toLowerCase()?this.options.createRow.apply(this,arguments):$('<tr class="'+this.options.classes.row+'" data-row="'+e+'"></tr>')},s.prototype._createCell=function(e){return"function"==(typeof this.options.createCell).toLowerCase()?this.options.createCell.apply(this,arguments):$('<td class="'+this.options.classes.cell+'"></td>')},s.prototype._createCellField=function(e){return"function"==(typeof this.options.createCellField).toLowerCase()?this.options.createCellField.apply(this,arguments):$('<input maxlength="1" tabindex="-1">')},s.prototype._createCluesListContainer=function(e){return"function"==(typeof this.options.createCluesListContainer).toLowerCase()?this.options.createCluesListContainer.apply(this,arguments):$('\n                <div class="'+this.options.classes.cluesListContainer+'">\n                    <p class="'+this.options.classes.cluesListTitle+'">'+(e?this.options.acrossListTitle:this.options.downListTitle)+"</p>\n                </div>\n            ")},s.prototype._createCluesList=function(e){return"function"==(typeof this.options.createCluesList).toLowerCase()?this.options.createCluesList.apply(this,arguments):$('<ul class="'+this.options.classes.clueList+'"></ul>')},s.prototype._createCluesListItem=function(e){return"function"==(typeof this.options.createCluesListItem).toLowerCase()?this.options.createCluesListItem.apply(this,arguments):$("<li></li>")},s.prototype._createDownCluesList=function(){var e=this.definition.downClues;this.downCluesContainer=this._createCluesListContainer(!1),this.downCluesList=this._createCluesList(!1);for(var t=0,s=e;t<s.length;t++){var i=s[t],o=this._createCluesListItem(i);this._addInfoToListElement(o,i),this.downCluesList.append(o),this.cluesRegistry[i.code].listItem=o}this.downCluesContainer&&this.downCluesContainer.append(this.downCluesList)},s.prototype._createAcrossCluesList=function(){var e=this.definition.acrossClues;this.acrossCluesContainer=this._createCluesListContainer(!0),this.acrossCluesList=this._createCluesList(!0);for(var t=0,s=e;t<s.length;t++){var i=s[t],o=this._createCluesListItem(i);this._addInfoToListElement(o,i),this.acrossCluesList.append(o),this.cluesRegistry[i.code].listItem=o}this.acrossCluesContainer&&this.acrossCluesContainer.append(this.acrossCluesList)},s.prototype._createCluesLists=function(){this._createAcrossCluesList(),this._createDownCluesList(),this.options.acrossListAppendTo?this.acrossCluesContainer?$(this.options.acrossListAppendTo).append(this.acrossCluesContainer):$(this.options.acrossListAppendTo).append(this.acrossCluesList):this.element.append(this.acrossCluesContainer),this.options.downListAppendTo?this.downCluesContainer?$(this.options.downListAppendTo).append(this.downCluesContainer):$(this.options.downListAppendTo).append(this.downCluesList):this.element.append(this.downCluesContainer)},s.prototype._addInfoToListElement=function(e,t){e.addClass(this.options.classes.listItem),t.across?(e.addClass(this.options.classes.clue+"--"+t.code),e.attr("data-across",t.code)):(e.addClass(this.options.classes.clue+"--"+t.code),e.attr("data-down",t.code)),e.text(t.clue)},s.prototype._addInfoToCellElement=function(e,t){e.attr({"data-x":t.x,"data-y":t.y}),(t.acrossClue||t.downClue)&&e.addClass(this.options.classes.clue),t.clueLabel&&(e.addClass(this.options.classes.firstLetter),0==t.acrossClueLetterIndex&&e.addClass(this.options.classes.firstLetterAcross),0==t.downClueLetterIndex&&e.addClass(this.options.classes.firstLetterDown)),t.acrossClue&&(e.addClass(this.options.classes.clue+"--"+t.acrossClue.code),e.attr("data-across",t.acrossClue.number)),t.downClue&&(e.addClass(this.options.classes.clue+"--"+t.downClue.code),e.attr("data-down",t.downClue.number)),t.light&&(e.addClass(this.options.classes.light),t.hint&&e.addClass(this.options.classes.hint))},s.prototype._createClueRegistry=function(){for(var e={},t=this.definition,s=t.acrossClues.concat(t.downClues),i=0,o=s.length;i<o;i++){var n=s[i],l=new r;l.definition=n,l.currentAnswer=new Array(n.answer.length),e[n.code]=l}return e},s.prototype._construct=function(){if(this.definition){for(var e=this.definition.matrix,t=this._createBoard(),s=[],i=this.cluesRegistry,r=0,l=e.length;r<l;r++){var c=e[r],a=void 0,d=[],u=[],h=new n;h.cellsRegistry=u;for(var C=0,p=c.length;C<p;C++){var f=c[C],g=this._createCell(f),w=new o,y=void 0;if(w.rowRegistry=h,this._addInfoToCellElement(g,f),w.definition=f,w.element=g,f.light)if(f.hint){if(g.text(f.answer),f.acrossClue)(v=i[f.acrossClue.code]).currentAnswer[f.acrossClueLetterIndex]=f.answer;if(f.downClue)(v=i[f.downClue.code]).currentAnswer[f.downClueLetterIndex]=f.answer}else{var v;if((y=this._createCellField(f)).addClass(this.options.classes.field),w.field=y,g.append(y),f.acrossClue)(v=i[f.acrossClue.code]).cellsElements.push(g),v.fieldsElements.push(y),v.cellsRegistries.push(w),w.acrossClueRegistry=v;if(f.downClue)(v=i[f.downClue.code]).cellsElements.push(g),v.fieldsElements.push(y),v.cellsRegistries.push(w),w.downClueRegistry=v}d.push(g),u[C]=w}(a=this._createRow(r))?(h.element=a,a.append(d),t.append(a)):t.append(d),s.push(h)}this.rowsRegistry=s,this.element.append(t)}},s.prototype._createDefinition=function(){var e=this.options.definition;e&&(e instanceof t.CrosswordDefinition!=!0&&(e=new t.CrosswordDefinition(e)),this.definition=e)},s}();$.widget("ui.crossword",l.prototype),e.CrosswordCellRegistry=o,e.CrosswordClueRegistry=r,e.CrosswordRowRegistry=n,e.CrosswordGame=l,Object.defineProperty(e,"__esModule",{value:!0})});
